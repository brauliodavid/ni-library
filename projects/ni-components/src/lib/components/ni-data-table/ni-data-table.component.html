<div class="ni-data-table">

	<ni-top-tabs [tabs]="tabs" [selectedTab]="0" [ngClass]="{'hidden': !tabs, 'tabsJoined': tabsStyle && tabsStyle == 'joined'}"></ni-top-tabs>

	<div class="ni-table" [ngClass]="{'tabsJoined': tabsStyle && tabsStyle == 'joined'}">
		<div class="ni-table-header">
			<ni-filters [filters]="filtersSections" [searchKey]="searchKey" [algoliaIndex]="algoliaIndex" [ngClass]="{'hidden': hideSearchSection}" [searchPlaceholder]="searchPlaceholder"></ni-filters>
		</div>
		<div class="ni-table-body-wrapper" [ngStyle]="{'position': 'relative'}">
			<div class="ni-table-body">
				<div class="data-loading-shade" *ngIf="isLoadingResults || isRateLimitReached">
					<mat-spinner *ngIf="isLoadingResults" [color]="'accent'" [mode]="'indeterminate'" [diameter]="'50'" [value]="'100'" [strokeWidth]="'3'"></mat-spinner>
					<div class="data-rate-limit-reached" *ngIf="isRateLimitReached">
						Rate limit has been reached. It will be reset in one minute.
					</div>
				</div>
				<div *ngIf="!dataSource.data || dataSource.data.length < 1" class="no-results-box">
					<div>
						<i class="material-icons">info</i>
						<span>No results found</span>
					</div>
				</div>
				<table mat-table [dataSource]="dataSource" matSort [matSortActive]="sortActive" matSortDisableClear [matSortDirection]="sortDirection" [ngClass]="{'table-hidden': !dataSource.data || dataSource.data.length < 1}">
					
					<!-- Select Column -->
					<ng-container matColumnDef="select">
						<th mat-header-cell *matHeaderCellDef [ngClass]="'checkboxCell'"> 
							<mat-checkbox (change)="$event ? masterToggle() : null"
								[checked]="selection.hasValue() && isAllSelected()"
								[indeterminate]="selection.hasValue() && !isAllSelected()">
							</mat-checkbox>
						</th>
						<td mat-cell *matCellDef="let service" [ngClass]="'checkboxCell'">
							<mat-checkbox (click)="$event.stopPropagation()"
								(change)="$event ? selection.toggle(service) : null"
								[checked]="selection.isSelected(service)">
							</mat-checkbox>
						</td>
					</ng-container>
				
					<!-- Columns -->
					<ng-container *ngFor="let column of columns" [matColumnDef]="column.key">
						<th mat-header-cell *matHeaderCellDef [mat-sort-header]="column.sorting ? column.key : null" [disabled]="!column.sorting ? true : false" [ngClass]="{'hidden': column.hidden, 'width2': column.width == 2}"> {{column.label}} </th>
						<td mat-cell *matCellDef="let doc" [ngClass]="{'hidden': column.hidden, 'width2': column.width == 2}">

							<div>
								<span [innerHTML]="sanitizer.bypassSecurityTrustHtml(column.content ? column.content(doc) : '')" (click)="column.onClick ? column.onClick(doc) : ''"></span>
							</div>

						</td>
					</ng-container>

					<!-- Actions Column -->
					<ng-container matColumnDef="row-actions">
						<th mat-header-cell *matHeaderCellDef [ngClass]="{'hidden': !rowActions}"></th>
						<td mat-cell *matCellDef="let doc, let i = index" [ngClass]="{'hidden': !rowActions}"> 
							<div *ngIf="rowActions && rowActions.length > 0" class="row-actions">
								<button mat-icon-button [matMenuTriggerFor]="actions">
									<mat-icon>more_vert</mat-icon>
								</button>
								<mat-menu #actions="matMenu">
									<div *ngFor="let action of rowActions">
										<button mat-menu-item (click)="runRowAction(action, doc, i)" [disabled]="!getRowActionPermissions(action, doc, i)">
											<span>
												<mat-icon>{{action.icon}}</mat-icon>
												<b>{{action.label}}</b>
											</span>
										</button>
									</div>
								</mat-menu>
							</div>
						</td>
					</ng-container>

					<tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true" class="header-row"></tr>
					<tr mat-row #tableRow *matRowDef="let row; columns: displayedColumns; let x = index" [@removingRow]="dataSource.data[x]['status']"></tr>
				</table>
			</div>
		</div>
		<div class="table-paginator">
			<div *ngIf="tableActions" class="table-actions">
				<div class="table-actions-dropdown">
					<mat-form-field>
						<mat-select placeholder="Actions">
							<mat-option *ngFor="let action of tableActions" (click)="runTableAction(action)" [disabled]="!getTableActionPermissions(action)">
								<span>
									<mat-icon>{{action.icon}}</mat-icon>
									<b>{{action.label}}</b>
								</span>
							</mat-option>
						</mat-select>
					</mat-form-field>
				</div>
			</div>
			<mat-paginator [length]="resultsLength" [pageSizeOptions]="[5, 10, 20, 50]" [pageSize]="10" [hidePageSize]="filters && filters.filtered" [ngClass]="{'filtered-paginator': filters && filters.filtered || dataSource.data.length < 1 || hidePaginator || statusFiltered}"></mat-paginator>
		</div>
	</div>
</div>
