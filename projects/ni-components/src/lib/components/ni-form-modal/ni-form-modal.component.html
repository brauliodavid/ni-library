<mat-dialog-content>
	<div [ngClass]="formClass">
		<div class="dialog-header">
			<h5>{{title}}</h5>
			<ni-alert *ngFor="let note of notes" [type]="note.type">{{note.content}}</ni-alert>
		</div>
		<div class="dialog-content" [formGroup]="fieldsArray">
			<div *ngFor="let field of fieldsArray.controls, let i =index" [formGroupName]="i" class="field-control" [ngClass]="field.value.fieldClass">
				
				<mat-form-field *ngIf="field.value.type === 'text'" [appearance]="field.value.appearance">
					<mat-label>{{field.value.label}}</mat-label>
					<input matInput [placeholder]="field.value.placeholder" formControlName="value" autocomplete="off">
					<mat-hint *ngIf="field.value.instructions" align="start"><strong>{{field.value.instructions}}</strong></mat-hint>
					<mat-error *ngIf="field.get('value').hasError('required')">
						{{field.value.label}} is <strong>required</strong>
					</mat-error>
				</mat-form-field>

				<mat-form-field *ngIf="field.value.type === 'number'" [appearance]="field.value.appearance">
					<mat-label>{{field.value.label}}</mat-label>
					<input matInput type="number" [placeholder]="field.value.placeholder" formControlName="value" autocomplete="off">
					<mat-hint *ngIf="field.value.instructions" align="start"><strong>{{field.value.instructions}}</strong></mat-hint>
					<mat-error *ngIf="field.get('value').hasError('required')">
						{{field.value.label}} is <strong>required</strong>
					</mat-error>
				</mat-form-field>

				<mat-form-field *ngIf="field.value.type === 'textarea'" [appearance]="field.value.appearance">
					<mat-label>{{field.value.label}}</mat-label>
					<textarea matInput [placeholder]="field.value.placeholder" formControlName="value"></textarea>
					<mat-hint *ngIf="field.value.instructions" align="start"><strong>{{field.value.instructions}}</strong></mat-hint>
					<mat-error *ngIf="field.get('value').hasError('required')">
						{{field.value.label}} is <strong>required</strong>
					</mat-error>
				</mat-form-field>

				<!--<mat-form-field *ngIf="field.value.type === 'date'">
					<input matInput [matDatepicker]="dpField" [placeholder]="field.value.label" [min]="getMinDate(field)" formControlName="value">
					<mat-datepicker-toggle matSuffix [for]="dpField"></mat-datepicker-toggle>
					<mat-datepicker #dpField [startAt]="field.value.startAt ? field.value.startAt : false"></mat-datepicker>
					<mat-hint *ngIf="field.value.instructions" align="start"><strong>{{field.value.instructions}}</strong></mat-hint>
					<mat-error *ngIf="field.get('value').hasError('required')">
						{{field.value.label}} is <strong>required</strong>
					</mat-error>
				</mat-form-field>-->

				<ni-datepicker *ngIf="field.value.type === 'date'" formControlName="value" [materialInput]="true" [label]="field.value.label" [placeholder]="field.value.placeholder"  [min]="field.value.minDate ? field.value.minDate : ''" [max]="field.value.maxDate ? field.value.maxDate : ''" [startAt]="field.value.startAt ? field.value.startAt : ''" [appearance]="field.value.appearance"></ni-datepicker>
				
				<ni-select *ngIf="field.value.type === 'select'" [label]="field.value.label" [placeholder]="field.value.placeholder" [multiple]="field.value.multiple" formControlName="value" (opened)="field.value.hasOwnProperty('onOpen') ? field.value['onOpen']() : ''" [appearance]="field.value.appearance">
					<ni-option *ngFor="let choice of field.value.choices" [value]="choice.value" [viewValue]="choice.label"></ni-option>
				</ni-select>

				<div *ngIf="field.value.type === 'radio'">
					<label class="label-radio-list">{{field.value.label}}</label>
					<mat-radio-group formControlName="value" class="radio-list">
						<mat-radio-button *ngFor="let choice of field.value.choices" [value]="choice.value">{{choice.label}}</mat-radio-button>
					</mat-radio-group>
				</div>

				<ni-chips-select *ngIf="field.value.type === 'chips-select'" formControlName="value" [label]="field.value.label" [placeholder]="field.value.placeholder" [instructions]="field.value.instructions" [choices]="field.value.choices" [appearance]="field.value.appearance"></ni-chips-select>
				
				<div *ngIf="field.value.type === 'checkbox'">
					<label class="label-radio-list">{{field.value.label}}</label>
					<div class="checkbox-choices">
						<mat-checkbox *ngFor="let choice of field.value.choices, let c = index" [checked]="checkedChoice(field, choice, c)" (change)="changeCheckbox($event, field, choice, c)" class="checkbox-item">{{choice.label}}</mat-checkbox>
					</div>
				</div>

				<div *ngIf="field.value.type === 'html'" class="plain-html">
					<div [innerHTML]="sanitizer.bypassSecurityTrustHtml(field.value.value)"></div>
				</div>

				<ni-alert *ngIf="field.value.type === 'note'">{{field.value.value}}</ni-alert>

				<mat-slide-toggle *ngIf="field.value.type === 'slide-toggle'" formControlName="value">{{field.value.label}}</mat-slide-toggle>

				<div *ngIf="field.value.type === 'editor'">
					<div *ngIf="field.value.label">{{field.value.label}}</div>
					<quill-editor formControlName="value" [styles]="{height: '180px'}" [modules]="editorModules"></quill-editor>
				</div>

				<div *ngIf="field.value.type === 'daterange'" formGroupName="range">
					<mat-form-field [appearance]="field.value.appearance">
						<mat-label>From</mat-label>
						<input matInput [matDatepicker]="dpTo" (focus)="dpTo.open()" type="text" formControlName="from" [min]="field.value.minDate ? field.value.minDate : ''" [max]="field.value.maxDate ? field.value.maxDate : ''" autocomplete="off">
						<mat-daterangepicker #dpTo touchUi="false" [startAt]="field.value.startAt ? field.value.startAt : false"></mat-daterangepicker>
					</mat-form-field>
					<mat-form-field [appearance]="field.value.appearance">
						<mat-label>To</mat-label>
						<input matInput [matDaterangepickerEnd]="dpTo" (focus)="dpTo.open()" type="text" formControlName="to" autocomplete="off" (dateChange)="onRangeChange(field)">
						<mat-datepicker-toggle matSuffix [for]="dpTo"></mat-datepicker-toggle>
					</mat-form-field>
				</div>
			</div>
		</div>
		<div class="dialog-actions">
			<div class="dialog-action">
				<button mat-button color="warn" (click)="onNoClick()">{{cancelLabel ? cancelLabel : 'Cancel'}}</button>
			</div>
			<div class="dialog-action">
				<button mat-button color="primary" (click)="onClick()">{{okLabel ? okLabel : 'Ok'}}</button>
			</div>
		</div>
	</div>
</mat-dialog-content>
